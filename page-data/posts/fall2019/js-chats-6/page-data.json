{
    "componentChunkName": "component---src-components-post-post-template-js",
    "path": "/posts/fall2019/js-chats-6/",
    "result": {"data":{"markdownRemark":{"html":"<p>In this session of JavaScript Chats, we will introduce\nthe concepts used in testing through JavaScript.\nThe example that we used is not complex or fancy, but\nthe point is to introduce the concept.</p>\n<ul>\n<li><a href=\"#test-driven-development\">Test Driven Development</a></li>\n<li><a href=\"#jest-a-javascript-testing-framework\">Jest: a JavaScript Testing Framework</a>\n<ul>\n<li><a href=\"#code-coverage-dont-even-try-to-get-to-100\">Code Coverage: Don't Even Try to Get to 100%</a></li>\n</ul>\n</li>\n<li><a href=\"#types-of-tests\">Types of Tests</a>\n<ul>\n<li><a href=\"#unit-testing\">Unit Testing</a></li>\n<li><a href=\"#integrated-testing\">Integrated Testing</a></li>\n</ul>\n</li>\n<li><a href=\"#mocking\">Mocking</a>\n<ul>\n<li><a href=\"#why-mock\">Why mock?</a></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"test-driven-development\" style=\"position:relative;\"><a href=\"#test-driven-development\" aria-label=\"test driven development permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Test Driven Development</h2>\n<blockquote>\n<p>Chicken or egg first?</p>\n</blockquote>\n<p>When you are writing a program, how do you know that\nyour program works?\nWhen I was doing my CS31 C++ homework, I try to layout\nthe logic of my program and then code it out.\nAfter the code is finished, I give it some test case\nand see if my program handles the test cases correctly.</p>\n<p>To test a function, you just add some code in the <code class=\"language-text\">main</code>\nfunction that calls the function with the test case inputs,\nand seeing if the output is correct. You either do it\nby printing it out and manually checking the output value,\nor by an assertion (with an if statement).</p>\n<p>The process I just described have the following\n(subjective) characteristics:</p>\n<ul>\n<li>You understand fully the code that you wrote (hopefully)</li>\n<li>There is quite a bit of labour on writing code to check\nyour answer (if statements, print statements)</li>\n<li>You are testing your own code that is not used by anyone\nelse</li>\n<li>Code comes before test</li>\n</ul>\n<p>There is an extremely opinionated\n<a href=\"https://en.wikipedia.org/wiki/Cowboy_coding\">Wikipedia page</a>\nthat criticizes this approach called cowboy coding.\nYou can see how opinionated it is based on the warning\non the wiki page:</p>\n<figure align=center>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fb8ebe63cb75d21ac25ec8fc8b32b31d/00e09/cowboy-warning.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.607361963190186%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABUklEQVQY0y2Q227iQABD8//f1PfdtA1QElhCCJM7E5hM7jfIclZl+2DZkiXLtvF4gtYFx5PAPweIIHqxfxaEYUScpMRJRpBVRLLlkiuklEiZc/nhstRcixalW4wnoMqW1T7FExlhIjmFEpEUiLQiSPVL+4nmnFT40f8ArTVlWVJVFW3T0A8TwzhhzOKDoZREcYxl+5ibEx/vJp9rh1+rI6Yj+W2n+L6H67pk2YU8l8RxjMxzVFGglOLxeLAsD4xx/0avEi75FREmHDzBbr/HcWwOf3Z87U7svRA3LLF9zVXVqNuNtqmB5w9gWf5yv98xFmAcRzzviGV9vtqZpom1WrG1HSxHvGBufOydy2a9Zrv9Ir5oDmGFyFqCWKJuV5ZlwZgXmKeRKIoJguA14/vouq6ZpolpHJjGnnHo6PuOru/puo62G6iagbodadpvr2eeZ/4BLKu8OB9leXsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Warning messages on the cowboy coding article\non Wikipedia\"\n        title=\"Warning messages on the cowboy coding article\non Wikipedia\"\n        src=\"/static/fb8ebe63cb75d21ac25ec8fc8b32b31d/a6d36/cowboy-warning.png\"\n        srcset=\"/static/fb8ebe63cb75d21ac25ec8fc8b32b31d/222b7/cowboy-warning.png 163w,\n/static/fb8ebe63cb75d21ac25ec8fc8b32b31d/ff46a/cowboy-warning.png 325w,\n/static/fb8ebe63cb75d21ac25ec8fc8b32b31d/a6d36/cowboy-warning.png 650w,\n/static/fb8ebe63cb75d21ac25ec8fc8b32b31d/e548f/cowboy-warning.png 975w,\n/static/fb8ebe63cb75d21ac25ec8fc8b32b31d/3c492/cowboy-warning.png 1300w,\n/static/fb8ebe63cb75d21ac25ec8fc8b32b31d/00e09/cowboy-warning.png 1854w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><em>The neutrality of this article is disputed.</em></p>\n</figure>\n<p>The popular kid that is compliant and is everybody's\nfavorite is called <strong>Test Driven Development</strong> (TDD).\nIf I were to name the one biggest difference between\ntest driven development and cowboy coding, it would be\nthat test comes first before the code.</p>\n<p>Before writing a single line of code, a test driven\ndeveloper will write the test cases first. But the\nfunction/module that we are testing contains no code\nand therefore does nothing. What is the point of\nwriting test cases that is going to fail?</p>\n<p>That is the central idea of test driven development.\nYou \"break\" your program with a failing test case,\nthen you go \"fix\" your program such that your program\npasses the test case. People often describes TDD in\n3 basic steps:</p>\n<ol>\n<li>Red: Write a test and make sure it fails.</li>\n<li>Green: Write the simplest, easiest possible code to\nmake the test pass.</li>\n<li>Refactor: Optimise and/or simplify the application\ncode, making sure that all the tests still pass.</li>\n</ol>\n<p>(Taken from James Sinclair, <a href=\"https://jrsinclair.com/articles/2016/gentle-introduction-to-javascript-tdd-intro/\">A Gentle Introduction to\nJavaScript Test Driven Development Part\n1</a>)</p>\n<blockquote>\n<p>Can you forsee any problem with this approach?</p>\n</blockquote>\n<h2 id=\"jest-a-javascript-testing-framework\" style=\"position:relative;\"><a href=\"#jest-a-javascript-testing-framework\" aria-label=\"jest a javascript testing framework permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Jest: a JavaScript Testing Framework</h2>\n<p>Let's experience test driven development with a testing\nframework called Jest. Assume that we are writing a\nNode.js server application. The first thing we need is to\nset up our application using <code class=\"language-text\">npm</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm init -y</code></pre></div>\n<p>We want to install the <code class=\"language-text\">jest</code> framework.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm install --save-dev jest</code></pre></div>\n<blockquote>\n<p>Note: The <code class=\"language-text\">--save-dev</code> options of the <code class=\"language-text\">npm</code> command saves the\ninstalled package as a development dependencies, meaning this\npackage is not needed for the application to work, but it is\nonly used during development. Can you see why there is a need\nto separate development and build dependencies?</p>\n</blockquote>\n<p>We are going to write a function <code class=\"language-text\">fizzBuzz</code> in a file called\n<code class=\"language-text\">utils.js</code>. The function takes in a number <code class=\"language-text\">x</code> as the\nonly argument, and returns the following strings:</p>\n<ul>\n<li><code class=\"language-text\">'fizz'</code> if <code class=\"language-text\">x</code> is divisible by 3</li>\n<li><code class=\"language-text\">'buzz'</code> if <code class=\"language-text\">x</code> is divisible by 5</li>\n<li><code class=\"language-text\">'fizz buzz'</code> if <code class=\"language-text\">x</code> is divisible by both 3 and 5</li>\n<li><code class=\"language-text\">x</code> as a string if <code class=\"language-text\">x</code> is divisible neither by 3 nor 5</li>\n</ul>\n<p>However, before we even start writing a single line of code,\nremember that tests come first. We create a file containing\nour test named <code class=\"language-text\">utils.test.js</code>. Then, we start writing our\nfirst test case!</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> fizzBuzz <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./utils'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fizz is returned on 3'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">fizzBuzz</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fizz'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The <code class=\"language-text\">test</code>, <code class=\"language-text\">expect</code> functions are implicitly defined by\nthe testing framework. Each <code class=\"language-text\">test</code> function takes in a\nstring as the name of the test and a function that executes\nthe test. Each <code class=\"language-text\">expect</code> function does an assertion on\na value.</p>\n<p>The Jest framework is designed such that if you read out\nthe test code, you understand what it is trying to\ntest for!</p>\n<blockquote>\n<p>Why does a good test has to be readable?</p>\n</blockquote>\n<p>This is definitely going to break since we have not even\ndefined our function or even created our file yet!\nBut this is fine, since we want our test to fail.</p>\n<p>Now, we add a script to our <code class=\"language-text\">package.json</code> to run the\ntest.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"jest\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Then, we can execute the test with <code class=\"language-text\">npm run test</code>.\nYou should see the following output.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">FAIL  ./utils.test.js\n● Test suite failed to run\n\n  Cannot find module './utils' from 'utils.test.js'\n\n  However, Jest was able to find:\n  \t'./utils.test.js'</code></pre></div>\n<p>This is our first failing test case! We can clearly\nsee the problem being the module <code class=\"language-text\">./utils</code> is\nnot found since we have not defined it. Following\nour Red, Green, Refactor process, we make our test\npass by creating our <code class=\"language-text\">utils.js</code>.\nAfter we create an empty file, we run our test\nagain. We should get failure again. Here is the error\nmessage.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token constant\">FAIL</span>  <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>utils<span class=\"token punctuation\">.</span>test<span class=\"token punctuation\">.</span>js\n✕ fizz is returned on <span class=\"token number\">3</span> <span class=\"token punctuation\">(</span>4ms<span class=\"token punctuation\">)</span>\n\n● fizz is returned on <span class=\"token number\">3</span>\n\n  <span class=\"token literal-property property\">TypeError</span><span class=\"token operator\">:</span> fizzBuzz is not a <span class=\"token keyword\">function</span>\n\n    <span class=\"token number\">2</span> <span class=\"token operator\">|</span>\n    <span class=\"token number\">3</span> <span class=\"token operator\">|</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fizz is returned on 3'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">></span> <span class=\"token number\">4</span> <span class=\"token operator\">|</span>   <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">fizzBuzz</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fizz'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token operator\">|</span>          <span class=\"token operator\">^</span>\n    <span class=\"token number\">5</span> <span class=\"token operator\">|</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token number\">6</span> <span class=\"token operator\">|</span>\n    <span class=\"token number\">7</span> <span class=\"token operator\">|</span>\n\n    at Object<span class=\"token punctuation\">.</span><span class=\"token operator\">&lt;</span>anonymous<span class=\"token operator\">></span> <span class=\"token punctuation\">(</span>utils<span class=\"token punctuation\">.</span>test<span class=\"token punctuation\">.</span>js<span class=\"token operator\">:</span><span class=\"token number\">4</span><span class=\"token operator\">:</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>We can see the beautifully formatted error message.\nWe know the problem is that we have not defined\nthe <code class=\"language-text\">fizzBuzz</code> function yet! With Jest, you do not\nneed to do much manual work to test your code!\nThe testing experience is every developer friendly.</p>\n<p>We had to executing the <code class=\"language-text\">npm run test</code> command\nafter each update to our file. Can we make it easier?\nCan Jest automatically run our test cases every time\nwe update our file? Yes!\nWe change our test script in <code class=\"language-text\">package.json</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"jest --watchAll\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We execute <code class=\"language-text\">npm run test</code> again. You should see\nthe same failing output. But our test program did\nnot quit but instead hangs on the terminal.</p>\n<p>Now we go defined our function.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// in utils.js</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fizzBuzz</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">x</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  fizzBuzz\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now, our test screen has updated, with a different\nerror message.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token constant\">FAIL</span>  <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>utils<span class=\"token punctuation\">.</span>test<span class=\"token punctuation\">.</span>js\n✕ fizz is returned on <span class=\"token number\">3</span> <span class=\"token punctuation\">(</span>3ms<span class=\"token punctuation\">)</span>\n\n● fizz is returned on <span class=\"token number\">3</span>\n\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>received<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span>expected<span class=\"token punctuation\">)</span> <span class=\"token comment\">// Object.is equality</span>\n\n  <span class=\"token literal-property property\">Expected</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span>\n  <span class=\"token literal-property property\">Received</span><span class=\"token operator\">:</span> <span class=\"token keyword\">undefined</span>\n\n    <span class=\"token number\">2</span> <span class=\"token operator\">|</span>\n    <span class=\"token number\">3</span> <span class=\"token operator\">|</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fizz is returned on 3'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">></span> <span class=\"token number\">4</span> <span class=\"token operator\">|</span>   <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">fizzBuzz</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fizz'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token operator\">|</span>                       <span class=\"token operator\">^</span>\n    <span class=\"token number\">5</span> <span class=\"token operator\">|</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token number\">6</span> <span class=\"token operator\">|</span>\n    <span class=\"token number\">7</span> <span class=\"token operator\">|</span></code></pre></div>\n<p>We can clearly see the returned value does not match\nthe expected value. As a developer, we only had to write\na few lines of test code to get all these nice features.\nWe don't need to care about what to print out if our test\nfails. We don't need to handle any if statements and such.</p>\n<p>Our test case still fails. Let's keep fixing it. Remember\nin test driven development, you want to write the minimal\ncode to get the test case to pass.</p>\n<p>To pass the only test case that we have, we can simply\nreturn <code class=\"language-text\">'fizz'</code> regardless of the function input.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fizzBuzz</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">x</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token string\">'fizz'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now our test passes. We are now in the \"green\" stage.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">PASS  ./utils.test.js\n✓ fizz is returned on 3 (1ms)</code></pre></div>\n<p>Let's keep adding failing test case then.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fizz buzz is returned on 15'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">fizzBuzz</span><span class=\"token punctuation\">(</span><span class=\"token number\">15</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fizz buzz'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now our test is \"red\". We write code to make\nit pass.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fizzBuzz</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">x</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">%</span> <span class=\"token number\">5</span> <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">'fizz buzz'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token string\">'fizz'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now, our test is green. We add more failing test cases.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'buzz is returned on 5'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">fizzBuzz</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'buzz'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>We write more code to fix the failing test.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fizzBuzz</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">x</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">%</span> <span class=\"token number\">5</span> <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">%</span> <span class=\"token number\">3</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">return</span> <span class=\"token string\">'fizz buzz'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">else</span> \n            <span class=\"token keyword\">return</span> <span class=\"token string\">'buzz'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">'fizz'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>We are now \"green\".\nWe add another test case to become \"red\".</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a number string 17 is returned on 17'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">fizzBuzz</span><span class=\"token punctuation\">(</span><span class=\"token number\">17</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'17'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now, we turn \"green\" by adding more code.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fizzBuzz</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">x</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">%</span> <span class=\"token number\">5</span> <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">%</span> <span class=\"token number\">3</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">return</span> <span class=\"token string\">'fizz buzz'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">else</span> \n            <span class=\"token keyword\">return</span> <span class=\"token string\">'buzz'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">%</span> <span class=\"token number\">3</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">'fizz'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> x<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>At this point, you might notice some problem. The code\nthat we wrote is not clean. Namely, there is unnecessarily\nnested if statements.</p>\n<p>That is why we have our \"refactor\" step in the 3.\nThe code from a TDD process can be quite convoluted since\nwe never thought about the overall structure or logic of\nour code in the process. After finishing the test, and\nwe have a complete version of our code. We might want to\nrefactor our code!.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fizzBuzz</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">x</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">%</span> <span class=\"token number\">15</span> <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">'fizz buzz'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">%</span> <span class=\"token number\">3</span> <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">'fizz'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">%</span> <span class=\"token number\">5</span> <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">'buzz'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> x<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>After refactoring, our code is cleaner, easy to read\nbut still have all the correct functionalities guaranteed\nby the test that we wrote. For reference, here is all the\ntest code that we wrote.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> fizzBuzz <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./utils'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fizz is returned on 3'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">fizzBuzz</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fizz'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fizz buzz is returned on 15'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">fizzBuzz</span><span class=\"token punctuation\">(</span><span class=\"token number\">15</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fizz buzz'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'buzz is returned on 5'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">fizzBuzz</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'buzz'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a number string 17 is returned on 17'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">fizzBuzz</span><span class=\"token punctuation\">(</span><span class=\"token number\">17</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'17'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"code-coverage-dont-even-try-to-get-to-100\" style=\"position:relative;\"><a href=\"#code-coverage-dont-even-try-to-get-to-100\" aria-label=\"code coverage dont even try to get to 100 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Code Coverage: Don't Even Try to Get to 100%</h3>\n<p>How do we know that we have written a set of comprehensive\ntest cases? Having all of our test passes does not mean we\nhave caught all the edge cases.\nAsk yourself: when you are testing your code, how would you\ncome up with edge cases?\nComing with edge cases is extremely hard. What if there is\na better way that use less of our brain power?</p>\n<p>In testing, code coverage is a measurement of how many\nlines of code are executed/exercised by the test cases.\nFor instance, we use the <code class=\"language-text\">fizzBuzz</code> example above.\nIf we remove the last test case\n<code class=\"language-text\">'a number string 17 is returned on 17'</code>, we know that\nthe code <code class=\"language-js\"><span class=\"token keyword\">return</span> x<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code> will not be ran by\nany test cases. Therefore, our test cases cannot\nguarantee that the line <code class=\"language-js\"><span class=\"token keyword\">return</span> x<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code> will\nbe correct.</p>\n<p>How can we see the code coverage then? There is an\noption in Jest for just that! We modify our test\nscript in <code class=\"language-text\">package.json</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n     <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"jest --watchAll --coverage\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We execute <code class=\"language-text\">npm run test</code>. You should see the following\noutput.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"> PASS  ./utils.test.js\n  ✓ fizz is returned on 3 (3ms)\n  ✓ fizz buzz is returned on 15\n  ✓ buzz is returned on 5 (7ms)\n  ✓ a number string 17 is returned on 17 (1ms)\n\n----------|----------|----------|----------|----------|-------------------|\nFile      |  % Stmts | % Branch |  % Funcs |  % Lines | Uncovered Line #s |\n----------|----------|----------|----------|----------|-------------------|\nAll files |      100 |      100 |      100 |      100 |                   |\n utils.js |      100 |      100 |      100 |      100 |                   |\n----------|----------|----------|----------|----------|-------------------|</code></pre></div>\n<p>If you remove the last test case, you wil see the code\ncoverage drops.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">----------|----------|----------|----------|----------|-------------------|\nFile      |  % Stmts | % Branch |  % Funcs |  % Lines | Uncovered Line #s |\n----------|----------|----------|----------|----------|-------------------|\nAll files |    88.89 |    83.33 |      100 |    88.89 |                   |\n utils.js |    88.89 |    83.33 |      100 |    88.89 |                 8 |\n----------|----------|----------|----------|----------|-------------------|</code></pre></div>\n<blockquote>\n<p>Typically, a large code base will not have 100% coverage.\nCan you think of why?</p>\n</blockquote>\n<h2 id=\"types-of-tests\" style=\"position:relative;\"><a href=\"#types-of-tests\" aria-label=\"types of tests permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Types of Tests</h2>\n<p>Tests can be generally classified into several categories\nby the number of components in the application that it tests for.\nIs it testing just one function? Is it testing an API endpoint?\nIs it testing the entire application from the UI (web/mobile app)\nto the backend (server and database)?\nThe difficulty of writing tests increases with the number of\ncomponents that it tests for.\nIt can summarized in the Test Pyramid.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a7ea0231a8f10ce299d036a49f1931ab/b4cdf/test-pyramid.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.44171779141104%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB4ElEQVQoz4VT2W7bMBD0XxSBI946SIk6TVFybNeO28SJ4QAt0H5Bgb71/9+mEFPbCYqiDwsew92dneXOhBDgnEGpDElqw366OxvnHEJKqDQGZ/wvLEkLaF1DCBnOswmgNEJtR9z1RxB6ewEDFlHYwaL93ILR98kYo2ibeyz9CziXEOeAESUYrcdpeAZlV6eJUZwp+P0efnuAWRgwcsUpozBxhlbXIIyEu9mZuuQCrliAvil5YlStKvTLJ4z+G5qtg4zFhT3jDJlK0ZkWhNFrwAmwxsHbETRkkiFYVmoMLyvkQw7jNdxhQL1pggxSShAawXd79HYM+0tAyiKslt+xavdXDRlHvWnh/BG77U88PvyCX3xB93GE0gqCCdySGzzc/8BY7xDRefC7MNRpCW8HUE7BQiMqVJsGKpFo/RbD+oREZzCNQffJgVEequmqFVzh3zOcNImFRF+4ILRSCu7gYYcyWN7nyJ0JSXJXwD166MaARAQ6/oeGiUzQWxceTY6xTjD/cIPC3KGrj1g0RzTlAXROgob1ukHECO6qESf/FIi8YTh97BSF7iATgf55hGnzwKZwJfKFDeurWZgmR7d3gXlb7rAev/7pPL+W/PpVJIQUobu6Nv81laowYXGSXybnN3K8RtGNhO5VAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"test pyramid showing cost and speed changes with\ndifferent types of tests\"\n        title=\"test pyramid showing cost and speed changes with\ndifferent types of tests\"\n        src=\"/static/a7ea0231a8f10ce299d036a49f1931ab/a6d36/test-pyramid.png\"\n        srcset=\"/static/a7ea0231a8f10ce299d036a49f1931ab/222b7/test-pyramid.png 163w,\n/static/a7ea0231a8f10ce299d036a49f1931ab/ff46a/test-pyramid.png 325w,\n/static/a7ea0231a8f10ce299d036a49f1931ab/a6d36/test-pyramid.png 650w,\n/static/a7ea0231a8f10ce299d036a49f1931ab/e548f/test-pyramid.png 975w,\n/static/a7ea0231a8f10ce299d036a49f1931ab/3c492/test-pyramid.png 1300w,\n/static/a7ea0231a8f10ce299d036a49f1931ab/b4cdf/test-pyramid.png 1417w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>(Image credit to Jess Champion,\n<a href=\"https://www.silverstripe.org/blog/developers-the-enduring-value-of-unit-tests/\">The Enduring Value of Unit Tests</a>)</p>\n<h3 id=\"unit-testing\" style=\"position:relative;\"><a href=\"#unit-testing\" aria-label=\"unit testing permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Unit Testing</h3>\n<p>Unit testing refers to testing a single unit of code.\nIt can be a module, a function, or a component.\nThe <code class=\"language-text\">fizzBuzz</code> example above is an example of a unit test.\nWe are conducting tests that only on a single function.</p>\n<h3 id=\"integrated-testing\" style=\"position:relative;\"><a href=\"#integrated-testing\" aria-label=\"integrated testing permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Integrated Testing</h3>\n<p>Integrated testing refers to testing an integration\nbetween 2 or more modules. Usually, this means that\nyou are testing your API endpoints, since API\nendpoints usually involve multiple modules, like\nrouting, actual endpoint logic, and database etc.</p>\n<p>Let's put our <code class=\"language-text\">fizzBuzz</code> into an <code class=\"language-text\">express</code> server.</p>\n<blockquote>\n<p><code class=\"language-text\">express</code> is a popular routing library for Node.js.</p>\n</blockquote>\n<p>Using the previous repository that we were working on,\nwe first install <code class=\"language-text\">express</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm install --save express </code></pre></div>\n<p>We create a file named <code class=\"language-text\">server.js</code> to contain our\nserver.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// server.js</span>\n<span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> fizzBuzz <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./utils'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/fizzBuzz/:num'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> number <span class=\"token operator\">=</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>params<span class=\"token punctuation\">.</span>num<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> answer <span class=\"token operator\">=</span> <span class=\"token function\">fizzBuzz</span><span class=\"token punctuation\">(</span>number<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> answer <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  app\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<blockquote>\n<p>Yes, I wrote the code before the test here. But\nthis is for demonstration purpose. If you do\nfollow TDD practice, this is probably not the best\nidea.</p>\n</blockquote>\n<p>Notice that we exported our <code class=\"language-text\">app</code>. This is because\nthat we need to use the <code class=\"language-text\">app</code> during testing.</p>\n<blockquote>\n<p>How would you go about testing this?</p>\n</blockquote>\n<p>At this point, we can start our application server,\nby calling <code class=\"language-text\">app.listen(3000)</code>.\nSend some requests to <code class=\"language-text\">localhost:3000/fizzBuzz</code>,\nand thus writing test cases based on that.\nHowever, this requires us to go to the network level\nfor testing. Also, our test will be very verbal since\nwe need to make network request but those are not\nas readable and the intention is not as clear.</p>\n<p>For testing HTTP server, we will use a package called\nSuperTest.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm install --save-dev supertest</code></pre></div>\n<p>This package allow us to test express application without\nhaving to start a server and explicitly send network request.\nMost importantly, it allows us to write tests in a very readable\nmanner.</p>\n<p>Time to write our test. Where should we put our test files?\nWe can put them in <code class=\"language-text\">server.test.js</code>. However, the <code class=\"language-text\">XXX.test.js</code>\nis usually where we put all the unit tests. The convention for\nintegration tests is to put them under a directory called\n<code class=\"language-text\">__tests__</code>. We are going to put the tests under a file\nnamed <code class=\"language-text\">fizzBuzzEndpoint-test.js</code>.</p>\n<p>For reference, this is what your file structure should look like.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">├── __tests__\n│   └── fizzBuzzEndpoint<span class=\"token operator\">-</span>test<span class=\"token punctuation\">.</span>js\n├── index<span class=\"token punctuation\">.</span>js\n├── <span class=\"token keyword\">package</span><span class=\"token operator\">-</span>lock<span class=\"token punctuation\">.</span>json\n├── <span class=\"token keyword\">package</span><span class=\"token punctuation\">.</span>json\n├── server<span class=\"token punctuation\">.</span>js\n├── utils<span class=\"token punctuation\">.</span>js\n└── utils<span class=\"token punctuation\">.</span>test<span class=\"token punctuation\">.</span>js</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// __tests__/fizzBuzzEndpoint-test.js</span>\n<span class=\"token keyword\">const</span> request <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'supertest'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> app <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../server'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/fizzBuzz endpoint'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should respond to request'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">done</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">request</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/fizzBuzz/1'</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span>done<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The <code class=\"language-text\">describe</code> function is provided by Jest. It allows\nyou to group individual tests into one group. Here,\nwe are grouping all the tests we want to do on the\n<code class=\"language-text\">/fizzBuzz</code> endpoint in one <code class=\"language-text\">describe</code>.</p>\n<p><code class=\"language-text\">it</code> is the same as the <code class=\"language-text\">test</code> function we used above.\nIt takes in a string and a callback function containing\nour code for one test. Note that requesting for an API\nendpoint is an asynchronous action. Therefore, the\ntest callback also takes in a <code class=\"language-text\">done</code> function, which is\npassed in by Jest. We call the <code class=\"language-text\">done</code> function when\nwe are done with the test. We are using <code class=\"language-text\">it</code> here\nsince it is readable: the <code class=\"language-text\">/fizzBuzz</code> endpoint should or\nshould not be doing something.</p>\n<p>Since the test is async, we can also use an alternative\n<code class=\"language-text\">async/await</code> syntax.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should not respond to request without number'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">await</span> <span class=\"token function\">request</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/fizzBuzz/'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token number\">404</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<blockquote>\n<p>Exercise: Can you translate the unit test that we wrote\ninto integration tests using <code class=\"language-text\">supertest</code>?</p>\n</blockquote>\n<h2 id=\"mocking\" style=\"position:relative;\"><a href=\"#mocking\" aria-label=\"mocking permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Mocking</h2>\n<p>Imagine that you are testing a backend system with database.\nThere is a function that interacts with some other server API.\nFor instance, it retrieves a user from another database APi.\nThen, it returns the full name of the user as string.\nHere is the code for it.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// utils.js</span>\n<span class=\"token keyword\">const</span> axios <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'axios'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getUserFullName</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token parameter\">userId</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://my.api.com/user/'</span> <span class=\"token operator\">+</span> userId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> user<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>firstName <span class=\"token operator\">+</span> <span class=\"token string\">' '</span> <span class=\"token operator\">+</span> user<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>lastName<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<blockquote>\n<p>Before we move on, how would you test it?</p>\n</blockquote>\n<p>If you write test for this function, you are not doing\na unit test. Instead, you are actually doing an\nintegration testing, since the function depends on\nthe correctness of the <code class=\"language-text\">axios</code> module. How do we\nactually test the logic within the function without\nhaving to depend on other modules/systems?</p>\n<p>We use a common testing technique called <strong>mocking</strong>.\nWe mock a fake but simplistic version of an external\ndependencies. I emphasize simplicity since simple code\nmeans less mistakes.</p>\n<p>Let's see how we can mock a database within Jest.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// utils.test.js</span>\n<span class=\"token keyword\">const</span> axios <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'axios'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> getUserFullName <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./utils'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\njest<span class=\"token punctuation\">.</span><span class=\"token function\">mock</span><span class=\"token punctuation\">(</span><span class=\"token string\">'axios'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should return full name'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> user <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">firstName</span><span class=\"token operator\">:</span> <span class=\"token string\">'Galen'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">lastName</span><span class=\"token operator\">:</span> <span class=\"token string\">'Wong'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    axios<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">.</span><span class=\"token function\">mockResolvedValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> user <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> fullName <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getUserFullName</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>fullName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Galen Wong'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>With <code class=\"language-js\">jest<span class=\"token punctuation\">.</span><span class=\"token function\">mock</span><span class=\"token punctuation\">(</span><span class=\"token string\">'axios'</span><span class=\"token punctuation\">)</span></code>, we tell Jest that we want\nto mock a module called <code class=\"language-text\">axios</code>. Within the test code body,\nwe overwrite the <code class=\"language-text\">axios.get</code> function, such that it returned\na promise with resolved value equal to <code class=\"language-js\"><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> user <span class=\"token punctuation\">}</span></code>.\nWhen our <code class=\"language-text\">getUserFullName</code> is executed, the object that we mocked\nwill be used as the return value of <code class=\"language-text\">axios.get</code>.</p>\n<h3 id=\"why-mock\" style=\"position:relative;\"><a href=\"#why-mock\" aria-label=\"why mock permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Why mock?</h3>\n<p>Apart from simply adhering to the definition of a unit test,\nwhat are the other benefits of mocking in test?\nThere are 2 important motivations to use mocking:</p>\n<ul>\n<li>reduce set up complexity of running tests</li>\n<li>reduce time taken to run tests</li>\n</ul>\n<p>If we were to test without mock, we would have to make\nsure that we have a server set up to receive calls from our\ntested function during test time. We have to know what data\nexists on the server. For instance, what is the name of the\nuser with id 1. With all these things to worry about, we\ncannot focus on our testing. Writing the infrastructure needed\nto support the testing is going to take way longer than actually\nimplementing your desired functionality.\nWith mocking, we reduce the set up complexity of testing.</p>\n<p>If we were to test by calling to a server, our test will\nrun for longer, since network call is time consuming operation.\nAs developer, we would like our test to run fast such that\nwe can know what is wrong quickly.</p>","frontmatter":{"date":"2019-11-20T00:00:00.000Z","title":"Introduction to Testing with JavaScript","subtitle":"JavaScript Chats with ACM Hack Session 6","author":null}}},"pageContext":{"slug":"/posts/fall2019/js-chats-6/"}},
    "staticQueryHashes": ["1274017682"]}