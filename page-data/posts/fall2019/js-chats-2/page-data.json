{"componentChunkName":"component---src-components-post-post-template-js","path":"/posts/fall2019/js-chats-2/","webpackCompilationHash":"4c560abf2fddd397abbe","result":{"data":{"markdownRemark":{"html":"<ul>\n<li><a href=\"#definitions\">Definitions</a></li>\n<li><a href=\"#javascript-and-asynchrony\">JavaScript and asynchrony</a></li>\n<li>\n<p><a href=\"#the-event-loop\">The event loop</a></p>\n<ul>\n<li><a href=\"#framing-the-problem\">Framing the problem</a></li>\n<li><a href=\"#starting-the-operation\">Starting the operation</a></li>\n<li><a href=\"#getting-the-results-back-na%c3%afve-approach\">Getting the results back: na√Øve approach</a></li>\n<li><a href=\"#introducing-the-event-loop\">Introducing the event loop</a></li>\n<li><a href=\"#javascript-asynchrony-in-academic-terms\">JavaScript asynchrony in academic terms</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#introducing-javascript-promises\">Introducing JavaScript Promises</a></p>\n<ul>\n<li><a href=\"#creating-promises\">Creating Promises</a></li>\n<li><a href=\"#-application-implementing-jspromiseresolve\">üçè Application: Implementing <code class=\"language-js\">Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></a></li>\n<li><a href=\"#consuming-promises\">Consuming promises</a></li>\n</ul>\n</li>\n<li><a href=\"#jsasync-functions\"><code class=\"language-js\"><span class=\"token keyword\">async</span></code> functions</a></li>\n</ul>\n<h2 id=\"definitions\"><a href=\"#definitions\" aria-label=\"definitions permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Definitions</h2>\n<blockquote>\n<p>What does it mean for an operation to be synchronous, or asynchronous?</p>\n</blockquote>\n<p>Let‚Äôs first get on the same page with regards to the terminology. For the\npurpose of this workshop, we define an operation to be <strong>synchronous</strong> or\n<strong>blocking</strong> if the operation would wait until the desired result is\navailable, and then return it. A classic example for a synchronous operation\nwould be POSIX‚Äôs <a href=\"https://pubs.opengroup.org/onlinepubs/9699919799/functions/read.html\"><code class=\"language-c\"><span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></a> system call by default, but Java‚Äôs\n<a href=\"https://docs.oracle.com/en/java/javase/13/docs/api/java.base/java/io/InputStream.html#read()\"><code class=\"language-java\"><span class=\"token class-name\">InputStream</span><span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></a> acts in a similar way. Consider, for instance,\nthis piece of Java code:</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">int</span> ch <span class=\"token operator\">=</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The <code class=\"language-java\"><span class=\"token class-name\">InputStream</span><span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code> function would return the next byte of data on\nstandard input directly. On the other hand, if the standard input is\nconnected to a terminal and the user does not type anything, then this\nfunction is essentially going to wait ‚Äì and <em>block</em> your application ‚Äì\nforever. Assuming your application is single-threaded, there is no way for it\nto do any work until the user types something.</p>\n<p>On the other end of the spectrum, we have <strong>asynchronous</strong>, or\n<strong>non-blocking</strong>, operations. The defining characteristic of this class of\noperations is that they would <em>not</em> wait for data to become available, but\nvariations exist on how data is actually delivered. Some, like POSIX‚Äôs\n<a href=\"https://pubs.opengroup.org/onlinepubs/9699919799/functions/read.html\"><code class=\"language-c\"><span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></a> system call using non-blocking mode, returns an error if the\ndata is not yet available or the data if it is. Others, like many APIs found\nin JavaScript, would notify the application when the data becomes available\nat a future time.</p>\n<p>The main benefit of making operations asynchronous is <em>enabling concurrency</em>.\nWhile the operation is being carried out in the background, because the\nfunction returns quickly we could continue doing computation while waiting\nfor the background task to finish. We could also launch multiple asynchronous\noperations at the same time.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Web browsers</span>\n<span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://example.com/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// At some future time, when a preliminary response has been received, this</span>\n  <span class=\"token comment\">// function will be called.</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Response status:'</span><span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">.</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// This will be printed first, as fetch() immediately returns after kicking off</span>\n<span class=\"token comment\">// the HTTP request.</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'After call to fetch()'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Prints:</span>\n<span class=\"token comment\">// After call to fetch()</span>\n<span class=\"token comment\">// Response status: 200</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Node.js</span>\nfs<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">'file.txt'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> fd</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// At some future time, when a file descriptor has been opened, this function</span>\n  <span class=\"token comment\">// will be called.</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'File descriptor opened:'</span><span class=\"token punctuation\">,</span> fd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'After call to fs.open()'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Prints:</span>\n<span class=\"token comment\">// After call to fs.open()</span>\n<span class=\"token comment\">// File descriptor opened: 3</span></code></pre></div>\n<h2 id=\"javascript-and-asynchrony\"><a href=\"#javascript-and-asynchrony\" aria-label=\"javascript and asynchrony permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JavaScript and asynchrony</h2>\n<blockquote>\n<p>Why is JavaScript asynchronous?</p>\n</blockquote>\n<p>First, a point of clarification. People often say that JavaScript is\ninherently asynchronous. But that‚Äôs not strictly true. Until the introduction\nof Promises in ES2015 (also known as ES6), the JavaScript <em>language</em> was\ncompletely synchronous. But <em>embedders</em> of JavaScript, like web browsers and\nNode.js, have provided useful APIs that are available only in asynchronous\nform.</p>\n<p>That doesn‚Äôt quite answer our question though. Why do web browsers decide to\nprovide so many asynchronous APIs?</p>\n<p>As it turns out, there are two factors that went into this design decision:</p>\n<ol>\n<li>JavaScript is generally used in a single-threaded setting, and</li>\n<li>a lot of the Web APIs listed have performance that is <em>I/O-bound</em> rather\nthan <em>CPU-bound</em>.</li>\n</ol>\n<p>Let‚Äôs consider the first point. JavaScript in browsers is single-threaded, so\nall of the UI updates and JavaScript execution happen on the same thread. If\nthe <code class=\"language-js\"><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code> operation had been synchronous, then the main JavaScript\nthread would not be able to execute any code until <code class=\"language-js\"><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code> returns.</p>\n<p>If we give this a moment of thought, it could seem quite disastrous. Imagine\ntrying to watch a 2-hour-long movie on YouTube, where the page tries to\n<code class=\"language-js\"><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code> the video. Because <code class=\"language-js\"><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code> blocks JavaScript execution,\n<strong>the entire page would freeze until the movie download completes</strong>! In other\nwords, such a <code class=\"language-js\"><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code> function wouldn‚Äôt be too different from an\ninfinite loop: it would block even visual updates like scrolling from\nworking.</p>\n<div align=center>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/824d5fe09106354ae606dae3bbce2920/26bc0/sync.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.84916201117319%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABk0lEQVQoz41T207jMBDN/3/U0kI3UAQSYh8QXXhAArFqII5jx9exD+M07Sq0D0x04rE916NxlXPGAeXLCc45OO9AiaazuQ0RYRiG0c5aixgjjDEjKnyXDDTbBrKVIJ9wSigQpJDoRAchBPq+R9M0UEqh+iB2Th36xAbUwkDDeIMbe4WbUKN2C1y6JVbuF9b+Amu3Qu0XuE+3uFO3oEyzZFWER8wBhDiu/OfSNXQUUFmNiVSW46pzDzOdmTxgcC23H3eNTZRUjvfEnUVOFKZkbT/gTdCBAtqrbGf8/2r+vJZuvgVUzJMJCdIlNMPOcys06hfNWrmLeFdh1DU7v8qiExJHP38Ss4Bjy6dIt2ZAnvTi/9yVcMfiuRiayj9UmEKHFFqkqBg93zgeCQ0r1oiyhu2u8bH9DdOuEOQlvFjCt2cI3QLdv+Uxh5kMc+MPoGg5M89h/wCnHuDVBlE/8vqX9xsG6/qZ94/QYjOr8GTLznsYHlbLnO5hbAEdodx9frbjgO+DVrNXkDN+Ljvb8jrKQO8DfgF88VgwiX0uvgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"A synchronous operation, illustrated by three parallel timelines of network\ncard usage, CPU usage, and JavaScript busyness\"\n        title=\"A synchronous operation, illustrated by three parallel timelines of network\ncard usage, CPU usage, and JavaScript busyness\"\n        src=\"/static/824d5fe09106354ae606dae3bbce2920/dbb61/sync.png\"\n        srcset=\"/static/824d5fe09106354ae606dae3bbce2920/19bd1/sync.png 163w,\n/static/824d5fe09106354ae606dae3bbce2920/d3bcb/sync.png 325w,\n/static/824d5fe09106354ae606dae3bbce2920/dbb61/sync.png 650w,\n/static/824d5fe09106354ae606dae3bbce2920/6b691/sync.png 975w,\n/static/824d5fe09106354ae606dae3bbce2920/91670/sync.png 1300w,\n/static/824d5fe09106354ae606dae3bbce2920/26bc0/sync.png 1790w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><em>A synchronous <code class=\"language-js\"><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code>.</em></p>\n</div>\n<p>Now, onto the second point. If <code class=\"language-js\"><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code> is synchronous, the network card\ncould do all the work in the background until the entire response is stored\nin memory. In other words, we <em>delay</em> CPU processing until a future point in\ntime, thus freeing the CPU for other tasks while the network transmission is\nbeing completed.</p>\n<p>On the other hand, with CPU-bound tasks like computing cryptographic hashes,\nsimply delaying its execution doesn‚Äôt quite help as we still need to do the\nwork on the main thread ‚Äì only the timing would be different.</p>\n<div align=center>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e7e513b46898cd9c308ecd76bc4d3039/26bc0/async.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.97206703910615%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACE0lEQVQ4y31TO4/TQBDOz6U7IQr+AQUNSFQI0dAgREV7BS+hCHQkpDnQ8YoQknNnJ/aun/v++LxOnAQd7GrsWc/sN/PNjCchBBwJtw8exhpYZ+GCi+cj4e5UC6UVjKGftdBaQymFCa5ZzjpkaYZOKh5w7WpFR3uHfJ1DlhJ5nkeZ2GCwcRmkF6h8icLl0NzrJsO0e4OPeoqpej3KTL/HO/USn9wHLMwZ0vbqKNAkkIKDoVj0Wh/AcjdNyQCMHiSDFSgpgkHr7Vk6gZZ600qWCmPJJv1BWzLzw9tsKSabGkUz6IwJ13/vfcxW57qqgJ9pPfjsAD0flWaRrYdUHkU7eH+7lDhPNSO0KDoHQRtUg1XlUJkQfb6uDS5WZdR7nEgZ/1iq7QZH1cEVAkFKuHUKXzcIbILbrGOqqlMxs12WQw1NDt+LlVF6bpX8DdP8ILJD0CXtJUIPRnswVaTvdYKyWI5g26aQu9f8wIvBUmdLDGeqk+iqFFYFWE+aHCHHslijUBecQZZBKzalzkdWMcO/qcYmcUg1q9/x0iq5hEgS6GIDsc6QriTqioAsRe8jywpCiMOxOf5TCDkaLYFf3b+NX49OYE7vYvb8Hs5mC5RSHiTgOWLNnvJhuvv2+6gLRp8/uInq4QnE41tYvn2G8y/fR8Ddnf9S3jsG9NOxPDtF8uQGsqd3MH8xx+fFBUvRHM3enh3wB40i7OGF8DCWAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"An asynchronous operation, illustrated by three parallel timelines of\nnetwork card usage, CPU usage, and JavaScript busyness\"\n        title=\"An asynchronous operation, illustrated by three parallel timelines of\nnetwork card usage, CPU usage, and JavaScript busyness\"\n        src=\"/static/e7e513b46898cd9c308ecd76bc4d3039/dbb61/async.png\"\n        srcset=\"/static/e7e513b46898cd9c308ecd76bc4d3039/19bd1/async.png 163w,\n/static/e7e513b46898cd9c308ecd76bc4d3039/d3bcb/async.png 325w,\n/static/e7e513b46898cd9c308ecd76bc4d3039/dbb61/async.png 650w,\n/static/e7e513b46898cd9c308ecd76bc4d3039/6b691/async.png 975w,\n/static/e7e513b46898cd9c308ecd76bc4d3039/91670/async.png 1300w,\n/static/e7e513b46898cd9c308ecd76bc4d3039/26bc0/async.png 1790w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><em>An asynchronous <code class=\"language-js\"><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code>.</em></p>\n</div>\n<blockquote>\n<p>Here‚Äôs a question for you. We‚Äôve considered why browsers have so many\nasynchronous APIs. Can you think of why Node.js, a JavaScript runtime used\nto write servers, would be similar in that way?</p>\n<details><summary>Click here for an answer.</summary>\nNode.js servers, like most web servers, are commonly expected to handle a\nlarge number of simultaneous requests. Synchronous operations would not\nallow for any concurrency between requests, as they require the server to\nfinish one request before starting another almost by definition. This makes\nasynchrony essential.\n<p>Additionally, Node.js servers are similar to the browser in that they are\nquite I/O-heavy as well. Web servers do a <em>lot</em> of I/O, from communicating\nwith the client using HTTP, to reading or writing to a file system, or\ntalking to a remote database server. The ability to do I/O concurrently\nwould be a great boon.</p>\n</details>\n</blockquote>\n<h2 id=\"the-event-loop\"><a href=\"#the-event-loop\" aria-label=\"the event loop permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The event loop</h2>\n<blockquote>\n<p>How are asynchronous operations implemented in JavaScript runtimes? </p>\n</blockquote>\n<p>As we have seen earlier, asynchronous operations in JavaScript generally has the following form:</p>\n<ol>\n<li>Upon the function call, an operation is started in the background, and the\nfunction immediately returns.</li>\n<li>The JavaScript code right after the function call runs, without the\nresults of the operation being available.</li>\n<li>At some future time, when the operation completes, a <em>callback function</em>\nwhich receives the results is called.</li>\n</ol>\n<p>Let‚Äôs take a deeper look at how this process works, by implementing our very\nown asynchronous <code class=\"language-js\"><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code> function. üçèüçèüçè</p>\n<h3 id=\"framing-the-problem\"><a href=\"#framing-the-problem\" aria-label=\"framing the problem permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Framing the problem</h3>\n<p>The actual <code class=\"language-js\"><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code> function in browsers returns a JavaScript\n<code class=\"language-js\">Promise</code> object, which we will get to soon. For now, let‚Äôs try to make a\nvery simple <code class=\"language-js\"><span class=\"token function\">basicFetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code> function that takes a URL and a callback\nfunction, and doesn‚Äôt return anything.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">basicFetch</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> <span class=\"token parameter\">data</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"starting-the-operation\"><a href=\"#starting-the-operation\" aria-label=\"starting the operation permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Starting the operation</h3>\n<p>We often say that JavaScript is a single-threaded programming language. This\nis true, but only for JavaScript execution, so that we don‚Äôt have to worry\nabout synchronization (race conditions) and other lower-level issues.\nBrowsers and other JavaScript runtimes often use multi-threading and other\ntechniques to parallelize I/O.</p>\n<p>With this in mind, let‚Äôs start writing this function!</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// This function runs in a worker thread, where we can use synchronous</span>\n<span class=\"token comment\">// operations without blocking the main thread.</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">fetchWorker</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">url<span class=\"token punctuation\">,</span> callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/* ‚Ä¶ */</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">basicFetch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">url<span class=\"token punctuation\">,</span> callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Get an available worker thread.</span>\n  <span class=\"token keyword\">const</span> thread <span class=\"token operator\">=</span> <span class=\"token function\">getAvailableThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Send the task type as well as the parameters to the worker thread. The</span>\n  <span class=\"token comment\">// worker thread would then call fetchWorker(url, callback) immediately.</span>\n  thread<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span>fetchWorker<span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">,</span> callback<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// The fetch has been started, so our job here is done.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"getting-the-results-back-na√Øve-approach\"><a href=\"#getting-the-results-back-na%C3%AFve-approach\" aria-label=\"getting the results back na√Øve approach permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Getting the results back: na√Øve approach</h3>\n<p>Well, that hopefully wasn‚Äôt too difficult to understand. Let‚Äôs now write the\n<code class=\"language-js\"><span class=\"token function\">fetchWorker</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code> function.</p>\n<p>After the I/O thread finishes the task, it would need to call the JavaScript\ncallback function to pass the data back to JavaScript code. Let‚Äôs do that.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// This function runs in a worker thread.</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">fetchWorker</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">url<span class=\"token punctuation\">,</span> callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Fetch the URL synchronously, and put its result in `buffer`.</span>\n  <span class=\"token keyword\">const</span> buffer <span class=\"token operator\">=</span> <span class=\"token function\">fetchURLSync</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>But wait‚Ä¶ This function runs on a separate thread. By calling the JavaScript\ncallback directly from a worker thread, we would be violating the JavaScript\nsingle-thread constraint, and cause all sorts of race conditions in a language\nnot prepared to deal with multithreading. No!!!</p>\n<h3 id=\"introducing-the-event-loop\"><a href=\"#introducing-the-event-loop\" aria-label=\"introducing the event loop permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introducing the event loop</h3>\n<blockquote>\n<p>This section is also available in video form on\n<a href=\"https://youtu.be/cCOL7MC4Pl0?t=430\">https://youtu.be/cCOL7MC4Pl0?t=430</a>. Jake Archibald can explain it several\nfold better than I can.</p>\n</blockquote>\n<p>To solve this problem, people invented the ‚Äúevent loop‚Äù approach. Instead of\ncalling the JavaScript callback directly, the worker thread would enqueue the\ncallback in a task queue that belongs to the JavaScript main thread.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// This function runs in a worker thread.</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">fetchWorker</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">loop<span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">,</span> callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Fetch the URL synchronously, and put its result in `buffer`.</span>\n  <span class=\"token keyword\">const</span> buffer <span class=\"token operator\">=</span> <span class=\"token function\">fetchURLSync</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Assume enqueueTask() does all the synchronization (locking) necessary to</span>\n  <span class=\"token comment\">// prevent race conditions.</span>\n  loop<span class=\"token punctuation\">.</span><span class=\"token function\">enqueueTask</span><span class=\"token punctuation\">(</span>callback<span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>On the main thread, a mechanism known as the ‚Äúevent loop‚Äù repeatedly polls\nthe task queue to see if there are any outstanding tasks on the task queue.\nIf so, it would run the tasks in FIFO order. However, it would only do so\nafter the existing functions all finish executing so as to not interrupt\nexecution of the current JavaScript function ‚Äì in other words, when the\nJavaScript stack becomes empty.</p>\n<p>Network responses is only one type of task. Web browsers have all sorts of\nAPIs that hook onto the event loop, like <code class=\"language-js\"><span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code> and DOM events.</p>\n<div align=\"center\">\n  <img src=\"https://i.imgur.com/rnQEY7o.png\" alt=\"Schema of interactions\n  between JavaScript, Web APIs, and the event loop\" width=\"600\"><br>\n  <em>JavaScript, Web APIs, and the event loop.</em>\n</div>\n<h3 id=\"javascript-asynchrony-in-academic-terms\"><a href=\"#javascript-asynchrony-in-academic-terms\" aria-label=\"javascript asynchrony in academic terms permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JavaScript asynchrony in academic terms</h3>\n<p>In systems design, this approach to asynchronous programming using event\nloops is often given two epithets:</p>\n<ol>\n<li><strong>Event-driven</strong>. This essentially means that the program wouldn‚Äôt do\nanything unless a task gets queued upon an external event (like when\nnetwork download finishes, or a timeout is up, or the user clicked a\nbutton).</li>\n<li><strong>Cooperative multitasking</strong>. JavaScript allows multitasking, but tasks\nwouldn‚Äôt get executed unless the current script finishes executing. This\nis in contrast with modern operating system schedulers, which would\ninterrupt and preempt long-running threads.</li>\n</ol>\n<h2 id=\"introducing-javascript-promises\"><a href=\"#introducing-javascript-promises\" aria-label=\"introducing javascript promises permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introducing JavaScript Promises</h2>\n<blockquote>\n<p>What are Promises in JavaScript? How do they ease asynchronous programming?</p>\n</blockquote>\n<p>By now, we have a pretty good idea of how asynchronous programming works in\nJavaScript, with callbacks. But despite all those concurrency improvements,\nthe programming flow really isn‚Äôt great. A phenomenon known as ‚Äú<a href=\"http://callbackhell.com/\">callback\nhell</a>‚Äù is often present in callback-based code that does a series of function\ncalls sequentially, with callbacks inside callbacks inside callbacks:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// callback hell</span>\nfs<span class=\"token punctuation\">.</span><span class=\"token function\">readFile</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> file</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Error reading file: '</span> <span class=\"token operator\">+</span> err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    fs<span class=\"token punctuation\">.</span><span class=\"token function\">writeFile</span><span class=\"token punctuation\">(</span>filename <span class=\"token operator\">+</span> <span class=\"token string\">'.new'</span><span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">,</span> <span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Error writing file: '</span> <span class=\"token operator\">+</span> err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Done!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Using Promises is a way to simplify that.</p>\n<p>At its most basic level, a JavaScript <code class=\"language-js\">Promise</code> object is simply a\ncontainer of JavaScript value, with a state attached to it that indicates if\nthe operation succeeds. By default, the Promise container is empty,\nindicating that the data is not yet available.</p>\n<h3 id=\"creating-promises\"><a href=\"#creating-promises\" aria-label=\"creating promises permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Creating Promises</h3>\n<p>If we want to use Promises with an existing callback-based API, we can use the Promise constructor.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// This Promise will become fulfilled when the fetch finishes.</span>\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">basicFetch</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> resolve<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// This Promise becomes fulfilled when the file is fully read. If an error</span>\n<span class=\"token comment\">// occurred, the Promise is rejected with the error.</span>\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFile</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> fd</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">else</span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// This Promise will remain empty forever.</span>\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"-application-implementing-jspromiseresolve\"><a href=\"#-application-implementing-jspromiseresolve\" aria-label=\" application implementing jspromiseresolve permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>üçè Application: Implementing <code class=\"language-js\">Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></h3>\n<p>In addition to the <code class=\"language-js\"><span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span></code> API as above, JavaScript provides a\nshorthand for creating a Promise that is assigned a value at creation:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// This Promise is assigned the value 1 upon creation.</span>\nPromise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>How would you go about implementing this method using <code class=\"language-js\"><span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span></code>?</p>\n<details><summary>Answer</summary>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">value</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</details>\n<h3 id=\"consuming-promises\"><a href=\"#consuming-promises\" aria-label=\"consuming promises permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Consuming promises</h3>\n<p>But unlike a usual container object, <code class=\"language-js\">Promise</code> objects don‚Äôt allow direct\naccess to the contained value. Instead, to access it or to wait for the value\nto become available, one attaches a <em>promise reaction</em> callback function\nusing the <code class=\"language-js\"><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code> function.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// When the promise is fulfilled with a value, print it out.</span>\npromise<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>If we were to rewrite our callback-hellish code using Promises instead, they\nwould look much more linear and intuitive.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Clean code with Promises</span>\nfs<span class=\"token punctuation\">.</span><span class=\"token function\">readFile</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">file</span> <span class=\"token operator\">=></span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">writeFile</span><span class=\"token punctuation\">(</span>filename <span class=\"token operator\">+</span> <span class=\"token string\">'.new'</span><span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Done!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'An error occurred: '</span> <span class=\"token operator\">+</span> err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"jsasync-functions\"><a href=\"#jsasync-functions\" aria-label=\"jsasync functions permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-js\"><span class=\"token keyword\">async</span></code> functions</h2>\n<blockquote>\n<p>How do <code class=\"language-js\"><span class=\"token keyword\">async</span></code> functions further simplify asynchronous code, and how do\nthey work?</p>\n</blockquote>\n<p>Promises themselves can be pretty useful already, but their real power lies\nin unlocking a new JavaScript feature called <code class=\"language-js\"><span class=\"token keyword\">async</span></code> functions. Remember\nall those <code class=\"language-js\"><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code>‚Äôs? <code class=\"language-js\"><span class=\"token keyword\">async</span></code> functions give us a way of getting rid\nof them.</p>\n<p>Here‚Äôs the code that does the same thing as above‚Ä¶ except <code class=\"language-js\"><span class=\"token punctuation\">.</span>then</code> doesn‚Äôt\nappear:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Clean code with async</span>\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> file <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFile</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">await</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">writeFile</span><span class=\"token punctuation\">(</span>filename <span class=\"token operator\">+</span> <span class=\"token string\">'.new'</span><span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">)</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Done!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'An error occurred: '</span> <span class=\"token operator\">+</span> err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This looks really really clean. The <code class=\"language-js\"><span class=\"token keyword\">await</span></code> operator would take a Promise\nobject, and, well, waits until the Promise resolves and get its value. In\nfact, it looks pretty much like a synchronous function, in that we could\ndirectly get the result of an asynchronous action. But how is it possible for\nthis not to have the same problems as synchronous code, and not block the\nentire main thread?</p>\n<p>It turns out that there are three special things about an async function:</p>\n<ol>\n<li>All <code class=\"language-js\"><span class=\"token keyword\">async</span></code> functions always return a Promise immediately, so calling the\nfunction does not directly yield the returned value, fitting our\ndefinition of an asynchronous operation.</li>\n<li>The execution of this specific function could be suspended and restarted.\nWhen the <code class=\"language-js\"><span class=\"token keyword\">await</span></code> operator is encountered, only the function will be\npaused, <em>without blocking the rest of the main thread.</em> This makes\n<code class=\"language-js\"><span class=\"token keyword\">async</span></code> functions not suffer from the same problems as synchronous\ncode.</li>\n<li>The <code class=\"language-js\"><span class=\"token keyword\">await</span></code> operator would register special Promise reaction callbacks\nto the given Promise, which would restart that particular instance of the\n<code class=\"language-js\"><span class=\"token keyword\">async</span></code> function using the values in the Promise.</li>\n</ol>\n<p>With these three things set up, <code class=\"language-js\"><span class=\"token keyword\">async</span></code> functions are able to do the\namazing things they do.</p>","frontmatter":{"date":"2019-10-15T00:00:00.000Z","title":"Asynchronous JavaScript","subtitle":"JavaScript Chats with ACM Hack Session 2"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/posts/fall2019/js-chats-2/"}}}